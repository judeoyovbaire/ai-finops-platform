# Grafana Dashboard ConfigMaps
# Dashboard source files are in /dashboards/ directory
# This file is auto-generated - edit the source JSON files, not this ConfigMap

apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: ai-finops
  labels:
    grafana_dashboard: "1"
data:
  # GPU Overview Dashboard
  # Source: /dashboards/gpu-overview.json
  # Panels:
  #   - Cost Overview: Total daily cost, GPU cost, spot savings, idle GPUs
  #   - Cost by Team: Pie chart and trend line
  #   - GPU Utilization: By node, by team (gauge), memory, temperature
  #   - Efficiency & Recommendations: GPU efficiency, idle hours, spot savings
  #   - Service Health: Query errors, latency metrics
  gpu-overview.json: |
    {"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"id":null,"links":[],"liveNow":false,"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":100,"panels":[],"title":"Cost Overview","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":500},{"color":"red","value":1000}]},"unit":"currencyUSD"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":1},"id":1,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(ai_finops_team_cost_daily)","legendFormat":"Total Daily Cost","refId":"A"}],"title":"Total Daily Cost","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":300},{"color":"red","value":500}]},"unit":"currencyUSD"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":6,"y":1},"id":2,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(ai_finops_gpu_cost_daily)","legendFormat":"GPU Cost","refId":"A"}],"title":"Daily GPU Cost","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":50},{"color":"red","value":100}]},"unit":"currencyUSD"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":12,"y":1},"id":3,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(ai_finops_spot_savings_potential)","legendFormat":"Spot Savings","refId":"A"}],"title":"Potential Spot Savings","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":2},{"color":"red","value":5}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":18,"y":1},"id":4,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"count(DCGM_FI_DEV_GPU_UTIL < 20)","legendFormat":"Idle GPUs","refId":"A"}],"title":"Idle GPUs (<20%)","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"mappings":[],"unit":"currencyUSD"},"overrides":[]},"gridPos":{"h":8,"w":8,"x":0,"y":5},"id":5,"options":{"legend":{"displayMode":"list","placement":"right","showLegend":true},"pieType":"donut","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"tooltip":{"mode":"single","sort":"none"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"ai_finops_team_cost_daily","legendFormat":"{{team}}","refId":"A"}],"title":"Daily Cost by Team","type":"piechart"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"opacity","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"currencyUSD"},"overrides":[]},"gridPos":{"h":8,"w":16,"x":8,"y":5},"id":6,"options":{"legend":{"calcs":["mean","lastNotNull"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"ai_finops_team_cost_daily","legendFormat":"{{team}}","refId":"A"}],"title":"Cost Trend by Team","type":"timeseries"},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":13},"id":101,"panels":[],"title":"GPU Utilization","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"Utilization %","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"auto","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"line+area"}},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"yellow","value":20},{"color":"green","value":50}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":14},"id":7,"options":{"legend":{"calcs":["mean","min","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"DCGM_FI_DEV_GPU_UTIL","legendFormat":"{{node}} - GPU {{gpu}} ({{team}})","refId":"A"}],"title":"GPU Utilization by Node","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"continuous-GrYlRd"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":14},"id":8,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"avg by (team) (DCGM_FI_DEV_GPU_UTIL)","legendFormat":"{{team}}","refId":"A"}],"title":"Average GPU Utilization by Team","type":"gauge"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"Memory %","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":0,"y":22},"id":9,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"DCGM_FI_DEV_MEM_COPY_UTIL","legendFormat":"{{node}} - GPU {{gpu}}","refId":"A"}],"title":"GPU Memory Utilization","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"continuous-BlYlRd"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"Temperature Â°C","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"scheme","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":2,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"line"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":75},{"color":"red","value":85}]},"unit":"celsius"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":12,"y":22},"id":10,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"DCGM_FI_DEV_GPU_TEMP","legendFormat":"{{node}} - GPU {{gpu}}","refId":"A"}],"title":"GPU Temperature","type":"timeseries"},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":28},"id":102,"panels":[],"title":"Efficiency & Recommendations","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"yellow","value":40},{"color":"green","value":70}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":6,"w":8,"x":0,"y":29},"id":11,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"avg by (team) (ai_finops_gpu_efficiency)","legendFormat":"{{team}}","refId":"A"}],"title":"GPU Efficiency by Team","type":"gauge"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":2},{"color":"red","value":5}]},"unit":"short"},"overrides":[]},"gridPos":{"h":6,"w":8,"x":8,"y":29},"id":12,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value_and_name"},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum by (team) (ai_finops_idle_gpu_hours)","legendFormat":"{{team}}","refId":"A"}],"title":"Idle GPU Hours by Team","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"currencyUSD"},"overrides":[]},"gridPos":{"h":6,"w":8,"x":16,"y":29},"id":13,"options":{"colorMode":"value","graphMode":"area","justifyMode":"center","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value_and_name"},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"ai_finops_spot_savings_potential","legendFormat":"{{node}} ({{instance_type}})","refId":"A"}],"title":"Spot Savings Potential by Node","type":"stat"},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":35},"id":103,"panels":[],"title":"Service Health","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":0,"y":36},"id":14,"options":{"legend":{"calcs":["sum"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"rate(ai_finops_prometheus_query_errors_total[5m])","legendFormat":"Prometheus - {{query_type}}","refId":"A"},{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"rate(ai_finops_opencost_query_errors_total[5m])","legendFormat":"OpenCost - {{endpoint}}","refId":"B"}],"title":"Query Error Rate","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"s"},"overrides":[]},"gridPos":{"h":6,"w":12,"x":12,"y":36},"id":15,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"histogram_quantile(0.95, rate(ai_finops_query_duration_seconds_bucket[5m]))","legendFormat":"p95 - {{source}}","refId":"A"},{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"histogram_quantile(0.50, rate(ai_finops_query_duration_seconds_bucket[5m]))","legendFormat":"p50 - {{source}}","refId":"B"}],"title":"Query Latency","type":"timeseries"}],"refresh":"10s","schemaVersion":38,"tags":["ai-finops","gpu","cost","opencost"],"templating":{"list":[{"current":{"selected":false,"text":"All","value":"$__all"},"datasource":{"type":"prometheus","uid":"prometheus"},"definition":"label_values(ai_finops_team_cost_daily, team)","hide":0,"includeAll":true,"label":"Team","multi":true,"name":"team","options":[],"query":{"query":"label_values(ai_finops_team_cost_daily, team)","refId":"PrometheusVariableQueryEditor-VariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":1,"type":"query"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"AI FinOps - GPU Overview","uid":"ai-finops-gpu-overview","version":1,"weekStart":""}
